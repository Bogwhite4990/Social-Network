<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shop</title>
    <!-- Include any CSS or stylesheets here -->
</head>
<body>
    <div class="navbar">
        <span>Welcome, <span class="username" id="user-username" data-selected-color="{{ current_user.selected_color }}">{{ current_user.username }}</span>! Coins: <span id="user-balance">{{ user_balance }}</span></span>
        <button class="dashboard-button" onclick="window.location.href='{{ url_for('dashboard') }}'">Dashboard</button>
    </div>
    <h1>Shop</h1>
    <p>Your Balance: <span id="user-balance-display">{{ user_balance }}</span> coins</p>

    <div class="shop-items">
        {% for item in shop_items %}
        <div class="shop-item">
            <h3>{{ item.name }}</h3>
            <p>Price: {{ item.price }} coins</p>
            <button onclick="buyItem({{ item.id }}, {{ item.price }})">Buy</button>
        </div>
        {% endfor %}
    </div>

    <!-- Include any other HTML content here -->

    <script>
        const shop_items = {{ shop_items|tojson|safe }};

        // Function to generate a random color
        function getRandomColor() {
            const colors = ["red", "blue", "green", "orange", "purple"]; // Add more colors as needed
            return colors[Math.floor(Math.random() * colors.length)];
        }

        // Function to handle the purchase of items
        function buyItem(itemId, itemPrice) {
            const userBalanceDisplay = document.getElementById('user-balance-display');
            let userBalance = parseInt(userBalanceDisplay.textContent);

            if (userBalance >= itemPrice) {
                fetch(`/buy_item/${itemId}`, {
                    method: 'POST',
                }).then(response => {
                    if (response.ok) {
                        userBalance -= itemPrice;
                        userBalanceDisplay.textContent = userBalance;
                        alert('Purchase successful!');

                        // Check if the purchased item is "Color Name"
                        if (itemId === 2) {
                            // Generate a random color
                            const randomColor = getRandomColor();

                            // Change the username color
                            const usernameElement = document.getElementById('user-username');
                            usernameElement.style.color = randomColor;

                            // Update the data attribute with the selected color
                            usernameElement.setAttribute('data-selected-color', randomColor);
                        }
                    } else {
                        alert('Purchase failed.');
                    }
                });
            } else {
                alert('Insufficient coins.');
            }
        }
    </script>
</body>
</html>
