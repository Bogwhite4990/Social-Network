<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shop</title>
    <!-- Include any CSS or stylesheets here -->
</head>
<body>
    <div class="navbar">
        <span>Welcome, <span class="username">{{ current_user.username }}</span>! Coins: <span id="user-balance">{{ current_user.coins }}</span></span>
        <button class="dashboard-button" onclick="window.location.href='{{ url_for('dashboard') }}'">Dashboard</button>
    </div>
    <h1>Shop</h1>
    <p>Your Balance: <span id="user-balance-display">{{ user_balance }}</span> coins</p>

    <div class="shop-items">
        {% for item in shop_items %}
        <div class="shop-item">
            <h3>{{ item.name }}</h3>
            <p>Price: {{ item.price }} coins</p>
            <button onclick="buyItem({{ item.id }}, {{ item.price }})">Buy</button>
        </div>
        {% endfor %}
    </div>

    <!-- Include any other HTML content here -->

    <script>
        // JavaScript function to handle item purchases
        function buyItem(itemId, itemPrice) {
            // Get the user's current balance from the page
            const userBalanceDisplay = document.getElementById('user-balance-display');
            const userBalance = parseInt(userBalanceDisplay.textContent);

            if (userBalance >= itemPrice) {
                // Send a request to Flask to process the purchase
                fetch(`/buy_item/${itemId}`, {
                    method: 'POST',
                }).then(response => {
                    if (response.ok) {
                        // Purchase successful, update the user's balance
                        const newBalance = userBalance - itemPrice;
                        userBalanceDisplay.textContent = newBalance;
                        alert('Purchase successful!');
                    } else {
                        alert('Purchase failed.');
                    }
                });
            } else {
                alert('Insufficient coins.');
            }
        }
    </script>
</body>
</html>
