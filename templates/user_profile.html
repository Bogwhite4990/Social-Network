<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Profile</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='user_profile.css') }}">
</head>
<body>
<div class="navbar">
    <span>Welcome, <a href="{{ url_for('profile') }}" class="username-link"><span class="username">{{ current_user.username }}</span></a>!</span>
    <button class="friends-button" onclick="window.location.href='{{ url_for('friends') }}'">Friends</button>
    <a href="{{ url_for('logout') }}" class="logout-button">Logout</a>
</div>
<!-- Add Reputation section -->
<div class="reputation-section">
    <h2>Reputation: <span id="reputation-count">{{ reputation }}</span></h2>
    <button
    id="give-reputation-button"
    data-receiver-user-id="{{ user.id }}"
    onclick="giveReputation(this.getAttribute('data-receiver-user-id'))"
>
    Give Reputation
</button>
    <p id="reputation-message"></p>
</div>
<div class="profile-container">
    <div class="profile-avatar">
        <!-- Display the user's avatar (profile photo) -->
        <img src="{{ url_for('static', filename='uploads/profile-photo/' ~ user.profile_photo) }}" alt="User Avatar">
    </div>
    <div class="profile-info">
        <!-- Display the user's name -->
        <h1>{{ user.username }}</h1>
        <button class="back-button" onclick="window.location.href='{{ url_for('dashboard') }}'">Back</button>
    </div>
</div>
<script>
document.addEventListener("DOMContentLoaded", function() {
    const reputationButton = document.getElementById("give-reputation-button");
    const reputationMessage = document.getElementById("reputation-message");
    const reputationCount = document.getElementById("reputation-count");

    reputationButton.addEventListener("click", function() {
        console.log("Button clicked");

        // Perform an AJAX request to the backend to update reputation
        fetch('/give-reputation', {
            method: 'POST',
            body: JSON.stringify({ receiver_user_id: reputationButton.getAttribute('data-receiver-user-id') }),
            headers: {
                'Content-Type': 'application/json',
            },
        })
        .then(response => {
            if (response.ok) {
                // Reputation updated successfully
                return response.json(); // Parse the response JSON
            } else {
                return Promise.reject('Error updating reputation');
            }
        })
        .then(data => {
            console.log(data);

            // Update the displayed reputation count on the page
            reputationCount.textContent = data.updated_reputation;
            reputationMessage.textContent = 'Reputation added successfully.';
            reputationButton.disabled = true;

            // Reload the user's profile page after a short delay
            setTimeout(function () {
                window.location.reload();
            }, 1000); // Reload after 1 second (adjust the delay as needed)
        })
        .catch(error => {
            // Handle error
            reputationMessage.textContent = 'Error updating reputation';
            console.error(error);
        });
    });
});



</script>
</body>
</html>
