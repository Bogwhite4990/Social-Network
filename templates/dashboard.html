<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='dashboard.css') }}">
</head>
<body>
    <div class="navbar">
        <span>Welcome, <span class="username" onclick="window.location.href='{{ url_for('profile') }}'">{{ username }}</span>!</span>
        <button class="upload-button" onclick="document.getElementById('upload-photo').click()">Upload</button>
        <a href="{{ url_for('logout') }}" class="logout-button">Logout</a>
    </div>

    <div class="dashboard-content">
        <div class="photo-section">
            <center>
            <h1>Welcome to the Dashboard</h1>
            <p>This is a protected area where you can access different features.</p>

            {% for photo in photos %}
                {% if photo.filename %}
                    <div class="photo-box uploaded-photo">
                        <div class="image-and-comments">
                            <div class="image-container">
                                <img class="uploaded-image" src="{{ url_for('static', filename='uploads/' ~ photo.filename) }}" alt="Uploaded Photo">
                                <p>Uploaded by {{ photo.user.username }}</p>
                            </div>
                        </div>
                        {% if current_user == photo.user %}
                            <form class="delete-form" action="{{ url_for('delete_photo', filename=photo.filename) }}" method="POST">
                                <button class="delete-button" type="submit">Delete</button>
                            </form>
                        {% endif %}
                    </div>
                {% endif %}
            {% endfor %}

            {% if not photos %}
                <p>No photos uploaded</p>
            {% endif %}</center>
        </div>

        <div class="comments-section">
            <form id="comment-form" action="{{ url_for('add_comment') }}" method="post">
                <label for="comment">Comment:</label>
                <textarea id="comment" name="comment"></textarea>
                <button type="submit">Submit Comment</button>
            </form>

            <div id="comments">
                {% for comment in comments %}
                    <div class="comment">
                        <p><strong>{{ comment[1] }}:</strong> {{ comment[2] }}</p>
                        {% if current_user.username == comment[1] %}
                            <form action="{{ url_for('delete_comment', comment_id=comment[0]) }}" method="post">
                                <button type="submit">x</button>
                            </form>
                        {% endif %}
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>

    <input type="file" id="upload-photo" style="display: none;" accept="image/jpeg,image/png" onchange="handleImageUpload(this)">

    <script>
        function handleImageUpload(input) {
            if (input.files && input.files[0]) {
                var formData = new FormData();
                formData.append('photo', input.files[0]);
                fetch("{{ url_for('upload_photo') }}", {
                    method: 'POST',
                    body: formData
                });
            }
        }
    </script>
</body>
</html>
